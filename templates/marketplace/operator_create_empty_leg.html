{% extends "base.html" %}

{% block title %}Create Empty Leg - JetFinder{% endblock %}

{% block content %}
<style>
    .create-empty-leg-container {
        min-height: 100vh;
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        padding: 40px 20px;
    }

    .create-card {
        background: rgba(0, 0, 0, 0.95);
        border: 1px solid #48484a;
        border-radius: 20px;
        padding: 50px;
        max-width: 900px;
        margin: 0 auto;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
    }

    .form-header {
        text-align: center;
        margin-bottom: 50px;
    }

    .form-header h1 {
        color: #F05545;
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        font-family: 'Rajdhani', sans-serif;
    }

    .form-header p {
        color: #8e8e93;
        font-size: 1.1rem;
        margin: 0;
    }

    .form-section {
        margin-bottom: 40px;
        padding: 30px;
        background: rgba(45, 45, 45, 0.3);
        border-radius: 16px;
        border: 1px solid #48484a;
    }

    .section-title {
        color: #ffffff;
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 2px solid #F05545;
        display: flex;
        align-items: center;
    }

    .section-title i {
        margin-right: 10px;
        color: #F05545;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
        margin-bottom: 25px;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-label {
        color: #ffffff;
        font-weight: 600;
        margin-bottom: 8px;
        display: block;
        font-size: 0.95rem;
    }

    .form-label .required {
        color: #F05545;
        margin-left: 4px;
    }

    .form-control,
    .form-select,
    .form-textarea {
        width: 100%;
        padding: 18px 20px;
        background: rgba(45, 45, 45, 0.8);
        border: 1px solid #48484a;
        border-radius: 12px;
        color: #ffffff;
        font-size: 16px;
        transition: all 0.3s ease;
        box-sizing: border-box;
    }

    .form-textarea {
        min-height: 120px;
        resize: vertical;
        font-family: inherit;
    }

    .form-control:focus,
    .form-select:focus,
    .form-textarea:focus {
        outline: none;
        border-color: #F05545;
        background: rgba(45, 45, 45, 1);
        box-shadow: 0 0 0 3px rgba(240, 85, 69, 0.1);
    }

    .form-select option {
        background: #2d2d2d;
        color: #ffffff;
    }

    .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .checkbox-item {
        display: flex;
        align-items: center;
        padding: 15px;
        background: rgba(45, 45, 45, 0.5);
        border-radius: 8px;
        border: 1px solid #48484a;
        transition: all 0.3s ease;
    }

    .checkbox-item:hover {
        background: rgba(45, 45, 45, 0.8);
    }

    .checkbox-item input[type="checkbox"] {
        margin-right: 10px;
        transform: scale(1.2);
    }

    .checkbox-item label {
        color: #ffffff;
        font-weight: 500;
        margin: 0;
        cursor: pointer;
    }

    .btn-submit {
        width: 100%;
        background: linear-gradient(135deg, #F05545, #d44437);
        border: none;
        color: white;
        padding: 20px;
        border-radius: 12px;
        font-weight: 700;
        font-size: 18px;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        cursor: pointer;
        font-family: 'Rajdhani', sans-serif;
        margin-top: 30px;
    }

    .btn-submit:hover {
        background: linear-gradient(135deg, #d44437, #F05545);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(240, 85, 69, 0.4);
    }

    .btn-cancel {
        background: rgba(108, 117, 125, 0.2);
        border: 1px solid rgba(108, 117, 125, 0.3);
        color: #8e8e93;
        padding: 15px 30px;
        border-radius: 8px;
        text-decoration: none;
        margin-right: 15px;
        transition: all 0.3s ease;
        display: inline-block;
    }

    .btn-cancel:hover {
        background: rgba(108, 117, 125, 0.3);
        color: #ffffff;
        text-decoration: none;
    }

    .form-help {
        color: #8e8e93;
        font-size: 0.85rem;
        margin-top: 5px;
        display: block;
    }

    .alert {
        padding: 15px 20px;
        border-radius: 12px;
        margin-bottom: 25px;
        border: none;
    }

    .alert-error {
        background: rgba(220, 53, 69, 0.2);
        color: #ff6b7a;
        border: 1px solid rgba(220, 53, 69, 0.3);
    }

    .alert-success {
        background: rgba(40, 167, 69, 0.2);
        color: #66d9a0;
        border: 1px solid rgba(40, 167, 69, 0.3);
    }

    .airport-search {
        position: relative;
    }

    .airport-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(45, 45, 45, 0.95);
        border: 1px solid #48484a;
        border-radius: 8px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
    }

    .airport-suggestion {
        padding: 12px 16px;
        cursor: pointer;
        transition: background-color 0.2s ease;
        border-bottom: 1px solid #48484a;
    }

    .airport-suggestion:hover {
        background: rgba(240, 85, 69, 0.2);
    }

    .airport-suggestion:last-child {
        border-bottom: none;
    }

    .suggestion-code {
        color: #F05545;
        font-weight: 600;
    }

    .suggestion-name {
        color: #ffffff;
        font-size: 0.9rem;
    }

    .suggestion-location {
        color: #8e8e93;
        font-size: 0.8rem;
    }

    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }

        .create-card {
            padding: 30px 20px;
        }

        .checkbox-group {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="create-empty-leg-container">
    <div class="create-card">
        <div class="form-header">
            <h1><i class="fas fa-route me-3"></i>Create Empty Leg Flight</h1>
            <p>List your empty leg flight to maximize aircraft utilization and generate additional revenue</p>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}">
            <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check-circle' }} me-2"></i>
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <form method="POST" id="emptyLegForm">
            <!-- Flight Information -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-route"></i>Flight Details
                </h3>
                <div class="form-row">
                    <div class="form-group airport-search">
                        <label for="departure_airport" class="form-label">
                            Departure Airport<span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="departure_airport" name="departure_airport" required
                            placeholder="Enter IATA/ICAO code (e.g., JFK, KJFK)" maxlength="4"
                            value="{{ data.departure_airport if data else '' }}">
                        <small class="form-help">Enter 3-4 letter airport code</small>
                        <div class="airport-suggestions" id="departure_suggestions"></div>
                    </div>
                    <div class="form-group airport-search">
                        <label for="arrival_airport" class="form-label">
                            Arrival Airport<span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="arrival_airport" name="arrival_airport" required
                            placeholder="Enter IATA/ICAO code (e.g., LAX, KLAX)" maxlength="4"
                            value="{{ data.arrival_airport if data else '' }}">
                        <small class="form-help">Enter 3-4 letter airport code</small>
                        <div class="airport-suggestions" id="arrival_suggestions"></div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="departure_date" class="form-label">
                            Departure Date<span class="required">*</span>
                        </label>
                        <input type="date" class="form-control" id="departure_date" name="departure_date" required
                            value="{{ data.departure_date if data else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="departure_time" class="form-label">
                            Departure Time<span class="required">*</span>
                        </label>
                        <input type="time" class="form-control" id="departure_time" name="departure_time" required
                            value="{{ data.departure_time if data else '' }}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="estimated_duration" class="form-label">
                            Estimated Flight Duration (minutes)
                        </label>
                        <input type="number" class="form-control" id="estimated_duration" name="estimated_duration"
                            placeholder="120" min="15" max="1440" value="{{ data.estimated_duration if data else '' }}">
                        <small class="form-help">Flight time in minutes (optional)</small>
                    </div>
                    <div class="form-group">
                        <label for="flexibility" class="form-label">
                            Schedule Flexibility
                        </label>
                        <select class="form-select" id="flexibility" name="flexibility">
                            <option value="none" {{ 'selected' if data and data.flexibility=='none' else '' }}>No
                                Flexibility</option>
                            <option value="1hour" {{ 'selected' if data and data.flexibility=='1hour' else '' }}>±1 Hour
                            </option>
                            <option value="3hours" {{ 'selected' if data and data.flexibility=='3hours' else '' }}>±3
                                Hours</option>
                            <option value="6hours" {{ 'selected' if data and data.flexibility=='6hours' else '' }}>±6
                                Hours</option>
                            <option value="1day" {{ 'selected' if data and data.flexibility=='1day' else '' }}>±1 Day
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Aircraft Information -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-plane"></i>Aircraft Details
                </h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="aircraft_type" class="form-label">
                            Aircraft Type<span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="aircraft_type" name="aircraft_type" required
                            placeholder="e.g., Citation XLS+, Gulfstream G550"
                            value="{{ data.aircraft_type if data else '' }}">
                    </div>
                    <div class="form-group">
                        <label for="aircraft_tail_number" class="form-label">
                            Tail Number
                        </label>
                        <input type="text" class="form-control" id="aircraft_tail_number" name="aircraft_tail_number"
                            placeholder="e.g., N123AB" style="text-transform: uppercase;"
                            value="{{ data.aircraft_tail_number if data else '' }}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="aircraft_category" class="form-label">
                            Aircraft Category<span class="required">*</span>
                        </label>
                        <select class="form-select" id="aircraft_category" name="aircraft_category" required>
                            <option value="">Select category</option>
                            <option value="Turboprop" {{ 'selected' if data and data.aircraft_category=='Turboprop'
                                else '' }}>Turboprop</option>
                            <option value="VLJ" {{ 'selected' if data and data.aircraft_category=='VLJ' else '' }}>Very
                                Light Jet (VLJ)</option>
                            <option value="Light" {{ 'selected' if data and data.aircraft_category=='Light' else '' }}>
                                Light Jet</option>
                            <option value="Midsize" {{ 'selected' if data and data.aircraft_category=='Midsize' else ''
                                }}>Midsize Jet</option>
                            <option value="Super Midsize" {{ 'selected' if data and
                                data.aircraft_category=='Super Midsize' else '' }}>Super Midsize Jet</option>
                            <option value="Heavy" {{ 'selected' if data and data.aircraft_category=='Heavy' else '' }}>
                                Heavy Jet</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="passenger_capacity" class="form-label">
                            Available Seats<span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="passenger_capacity" name="passenger_capacity"
                            required placeholder="8" min="1" max="50"
                            value="{{ data.passenger_capacity if data else '' }}">
                    </div>
                </div>
            </div>

            <!-- Pricing & Contact -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-dollar-sign"></i>Pricing & Contact
                </h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="price" class="form-label">
                            Flight Price (USD)<span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="price" name="price" required placeholder="5000"
                            min="100" value="{{ data.price if data else '' }}">
                        <small class="form-help">Total flight cost for all passengers</small>
                    </div>
                    <div class="form-group">
                        <label for="contact_info" class="form-label">
                            Contact Information<span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="contact_info" name="contact_info" required
                            placeholder="Phone: +1-555-123-4567 or Email: ops@company.com"
                            value="{{ data.contact_info if data else '' }}">
                    </div>
                </div>
                <div class="form-group full-width">
                    <label for="description" class="form-label">
                        Flight Description & Notes
                    </label>
                    <textarea class="form-textarea" id="description" name="description"
                        placeholder="Describe the empty leg opportunity, any special requirements, catering options, etc.">{{ data.description if data else '' }}</textarea>
                    <small class="form-help">Additional details to help customers understand this opportunity</small>
                </div>
            </div>

            <!-- Additional Services -->
            <div class="form-section">
                <h3 class="section-title">
                    <i class="fas fa-concierge-bell"></i>Available Services
                </h3>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="catering_available" name="catering_available" {{ 'checked' if data
                            and data.catering_available else '' }}>
                        <label for="catering_available">Catering Available</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="wifi_available" name="wifi_available" {{ 'checked' if data and
                            data.wifi_available else '' }}>
                        <label for="wifi_available">Wi-Fi Available</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="pets_allowed" name="pets_allowed" {{ 'checked' if data and
                            data.pets_allowed else '' }}>
                        <label for="pets_allowed">Pets Allowed</label>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <a href="{{ url_for('operator_dashboard') }}" class="btn-cancel">
                    <i class="fas fa-times me-2"></i>Cancel
                </a>
                <button type="submit" class="btn-submit">
                    <i class="fas fa-plane-departure me-2"></i>Create Empty Leg Listing
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('departure_date').min = today;

        // Airport search functionality
        const departureInput = document.getElementById('departure_airport');
        const arrivalInput = document.getElementById('arrival_airport');

        function setupAirportSearch(input, suggestionsId) {
            const suggestions = document.getElementById(suggestionsId);

            input.addEventListener('input', function () {
                const value = this.value.toUpperCase();
                this.value = value;

                if (value.length >= 2) {
                    // Simulate airport search - replace with actual API call
                    searchAirports(value).then(results => {
                        displaySuggestions(suggestions, results, input);
                    });
                } else {
                    suggestions.style.display = 'none';
                }
            });

            input.addEventListener('blur', function () {
                // Delay hiding to allow click on suggestion
                setTimeout(() => {
                    suggestions.style.display = 'none';
                }, 200);
            });
        }

        function searchAirports(query) {
            // Mock airport data - replace with actual API call
            const mockAirports = [
                { code: 'JFK', name: 'John F. Kennedy International Airport', city: 'New York', state: 'NY' },
                { code: 'LAX', name: 'Los Angeles International Airport', city: 'Los Angeles', state: 'CA' },
                { code: 'MIA', name: 'Miami International Airport', city: 'Miami', state: 'FL' },
                { code: 'LAS', name: 'Harry Reid International Airport', city: 'Las Vegas', state: 'NV' },
                { code: 'TEB', name: 'Teterboro Airport', city: 'Teterboro', state: 'NJ' },
                { code: 'VNY', name: 'Van Nuys Airport', city: 'Van Nuys', state: 'CA' }
            ];

            const filtered = mockAirports.filter(airport =>
                airport.code.includes(query) ||
                airport.name.toUpperCase().includes(query) ||
                airport.city.toUpperCase().includes(query)
            );

            return Promise.resolve(filtered.slice(0, 5));
        }

        function displaySuggestions(container, suggestions, input) {
            container.innerHTML = '';

            if (suggestions.length === 0) {
                container.style.display = 'none';
                return;
            }

            suggestions.forEach(airport => {
                const item = document.createElement('div');
                item.className = 'airport-suggestion';
                item.innerHTML = `
                    <div class="suggestion-code">${airport.code}</div>
                    <div class="suggestion-name">${airport.name}</div>
                    <div class="suggestion-location">${airport.city}, ${airport.state}</div>
                `;

                item.addEventListener('click', function () {
                    input.value = airport.code;
                    container.style.display = 'none';
                });

                container.appendChild(item);
            });

            container.style.display = 'block';
        }

        setupAirportSearch(departureInput, 'departure_suggestions');
        setupAirportSearch(arrivalInput, 'arrival_suggestions');

        // Form validation
        const form = document.getElementById('emptyLegForm');
        form.addEventListener('submit', function (e) {
            const departureAirport = document.getElementById('departure_airport').value;
            const arrivalAirport = document.getElementById('arrival_airport').value;

            if (departureAirport === arrivalAirport) {
                e.preventDefault();
                alert('Departure and arrival airports cannot be the same.');
                return;
            }

            if (departureAirport.length < 3 || arrivalAirport.length < 3) {
                e.preventDefault();
                alert('Please enter valid airport codes (3-4 letters).');
                return;
            }
        });

        // Auto-uppercase tail number
        document.getElementById('aircraft_tail_number').addEventListener('input', function () {
            this.value = this.value.toUpperCase();
        });
    });
</script>
{% endblock %}