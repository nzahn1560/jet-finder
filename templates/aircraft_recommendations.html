{% extends "base.html" %}

{% block title %}AI Aircraft Recommendations - Jet Finder{% endblock %}

{% block additional_css %}
<style>
    .recommendations-container {
        background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #0a0a0a 100%);
        min-height: 100vh;
        padding: 40px 0;
    }

    .recommendations-header {
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(240, 85, 69, 0.2);
        padding: 40px 0;
        margin-bottom: 40px;
    }

    .recommendations-title {
        font-family: 'Orbitron', sans-serif;
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #F05545, #007aff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 10px;
    }

    .recommendations-subtitle {
        color: #a1a1aa;
        font-size: 1.2rem;
        font-family: 'Rajdhani', sans-serif;
        margin-bottom: 20px;
    }

    .pricing-badge {
        background: linear-gradient(135deg, #F05545, #d44437);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 700;
        display: inline-block;
        font-family: 'Rajdhani', sans-serif;
    }

    .form-section {
        background: rgba(0, 0, 0, 0.8);
        border: 1px solid rgba(240, 85, 69, 0.2);
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 30px;
        backdrop-filter: blur(10px);
    }

    .section-title {
        color: #F05545;
        font-size: 1.3rem;
        font-weight: 700;
        margin-bottom: 20px;
        font-family: 'Orbitron', sans-serif;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
    }

    .form-label {
        color: #a1a1aa;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
        font-family: 'Rajdhani', sans-serif;
    }

    .form-input {
        background: rgba(71, 71, 71, 0.3);
        border: 1px solid #3a3a3c;
        border-radius: 8px;
        padding: 12px 15px;
        color: #ffffff;
        font-size: 16px;
        transition: all 0.3s ease;
        font-family: 'Rajdhani', sans-serif;
    }

    .form-input:focus {
        outline: none;
        border-color: #F05545;
        background: rgba(71, 71, 71, 0.5);
    }

    .weight-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .weight-group {
        display: flex;
        flex-direction: column;
    }

    .weight-slider {
        -webkit-appearance: none;
        appearance: none;
        height: 6px;
        background: #3a3a3c;
        border-radius: 3px;
        outline: none;
        margin: 10px 0;
    }

    .weight-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: linear-gradient(135deg, #F05545, #d44437);
        border-radius: 50%;
        cursor: pointer;
    }

    .weight-slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        background: linear-gradient(135deg, #F05545, #d44437);
        border-radius: 50%;
        cursor: pointer;
        border: none;
    }

    .weight-value {
        color: #F05545;
        font-weight: 700;
        font-size: 16px;
        text-align: center;
        font-family: 'Rajdhani', sans-serif;
    }

    .search-btn {
        background: linear-gradient(135deg, #F05545, #d44437);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 15px 40px;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Rajdhani', sans-serif;
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 30px auto;
    }

    .search-btn:hover {
        background: linear-gradient(135deg, #d44437, #F05545);
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(240, 85, 69, 0.3);
    }

    .search-btn:disabled {
        background: #3a3a3c;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .results-section {
        margin-top: 40px;
        display: none;
    }

    .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 15px;
    }

    .results-count {
        color: #a1a1aa;
        font-size: 16px;
        font-family: 'Rajdhani', sans-serif;
    }

    .aircraft-recommendation {
        background: rgba(0, 0, 0, 0.8);
        border: 1px solid rgba(240, 85, 69, 0.2);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 20px;
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 25px;
        align-items: center;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .aircraft-recommendation:hover {
        border-color: rgba(240, 85, 69, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(240, 85, 69, 0.1);
    }

    .aircraft-image {
        width: 120px;
        height: 80px;
        object-fit: cover;
        border-radius: 12px;
        border: 1px solid #3a3a3c;
    }

    .aircraft-info {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .aircraft-name {
        color: #ffffff;
        font-size: 1.4rem;
        font-weight: 700;
        margin-bottom: 5px;
        font-family: 'Orbitron', sans-serif;
    }

    .aircraft-subtitle {
        color: #a1a1aa;
        font-size: 14px;
        font-family: 'Rajdhani', sans-serif;
    }

    .specs-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 15px;
        margin: 10px 0;
    }

    .spec-item {
        text-align: center;
    }

    .spec-label {
        color: #71717a;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 3px;
        font-family: 'Rajdhani', sans-serif;
    }

    .spec-value {
        color: #ffffff;
        font-size: 14px;
        font-weight: 600;
        font-family: 'Rajdhani', sans-serif;
    }

    .pros-cons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 10px;
    }

    .pros,
    .cons {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid rgba(71, 71, 71, 0.3);
    }

    .pros {
        background: rgba(16, 185, 129, 0.1);
        border-color: rgba(16, 185, 129, 0.3);
    }

    .cons {
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.3);
    }

    .pros-title,
    .cons-title {
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 5px;
        font-family: 'Rajdhani', sans-serif;
    }

    .pros-title {
        color: #10b981;
    }

    .cons-title {
        color: #ef4444;
    }

    .pros-list,
    .cons-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .pros-list li,
    .cons-list li {
        font-size: 12px;
        margin-bottom: 3px;
        padding-left: 15px;
        position: relative;
        font-family: 'Rajdhani', sans-serif;
    }

    .pros-list li {
        color: #10b981;
    }

    .cons-list li {
        color: #ef4444;
    }

    .pros-list li::before {
        content: "✓";
        position: absolute;
        left: 0;
        color: #10b981;
    }

    .cons-list li::before {
        content: "×";
        position: absolute;
        left: 0;
        color: #ef4444;
    }

    .score-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        min-width: 150px;
    }

    .match-score {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 5px;
        font-family: 'Orbitron', sans-serif;
    }

    .score-excellent {
        color: #10b981;
    }

    .score-good {
        color: #f59e0b;
    }

    .score-fair {
        color: #ef4444;
    }

    .score-label {
        color: #a1a1aa;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        margin-bottom: 10px;
        font-family: 'Rajdhani', sans-serif;
    }

    .price-estimate {
        color: #F05545;
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 5px;
        font-family: 'Rajdhani', sans-serif;
    }

    .budget-status {
        font-size: 12px;
        font-weight: 600;
        font-family: 'Rajdhani', sans-serif;
    }

    .budget-good {
        color: #10b981;
    }

    .budget-over {
        color: #ef4444;
    }

    .view-details-btn {
        background: linear-gradient(135deg, #007aff, #0056cc);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        margin-top: 10px;
        font-family: 'Rajdhani', sans-serif;
    }

    .view-details-btn:hover {
        background: linear-gradient(135deg, #0056cc, #007aff);
        transform: translateY(-1px);
        text-decoration: none;
        color: white;
    }

    .loading-section {
        text-align: center;
        padding: 60px 20px;
        display: none;
    }

    .loading-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid #3a3a3c;
        border-top: 3px solid #F05545;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .loading-text {
        color: #a1a1aa;
        font-size: 16px;
        font-family: 'Rajdhani', sans-serif;
    }

    .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #71717a;
        font-family: 'Rajdhani', sans-serif;
    }

    .no-results h3 {
        color: #a1a1aa;
        margin-bottom: 15px;
        font-family: 'Orbitron', sans-serif;
    }

    @media (max-width: 768px) {
        .recommendations-title {
            font-size: 2rem;
        }

        .form-grid {
            grid-template-columns: 1fr;
        }

        .weight-section {
            grid-template-columns: 1fr;
        }

        .aircraft-recommendation {
            grid-template-columns: 1fr;
            text-align: center;
        }

        .pros-cons {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="recommendations-container">
    <!-- Header -->
    <div class="recommendations-header">
        <div class="container">
            <h1 class="recommendations-title">AI Aircraft Recommendations</h1>
            <p class="recommendations-subtitle">
                Get personalized aircraft recommendations based on your specific needs and preferences
            </p>
            <span class="pricing-badge">$5 per search</span>
        </div>
    </div>

    <div class="container">
        <!-- Requirements Form -->
        <div class="form-section">
            <h2 class="section-title">Your Requirements</h2>
            <form id="recommendationsForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Passenger Count *</label>
                        <input type="number" class="form-input" id="passengers" name="passengers" min="1" max="50"
                            required placeholder="e.g., 6">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Typical Range (nm) *</label>
                        <input type="number" class="form-input" id="typical_range" name="typical_range" min="100"
                            max="10000" required placeholder="e.g., 2000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Budget ($) *</label>
                        <input type="number" class="form-input" id="max_budget" name="max_budget" min="100000"
                            step="10000" required placeholder="e.g., 5000000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Airport Preferences (optional)</label>
                        <input type="text" class="form-input" id="airport_preferences" name="airport_preferences"
                            placeholder="e.g., KJFK, KLAX">
                    </div>
                </div>
            </form>
        </div>

        <!-- Weight Preferences -->
        <div class="form-section">
            <h2 class="section-title">Priority Weights</h2>
            <p style="color: #a1a1aa; margin-bottom: 20px; font-family: 'Rajdhani', sans-serif;">
                Adjust the importance of each factor for your recommendations
            </p>
            <div class="weight-section">
                <div class="weight-group">
                    <label class="form-label">Price (25%)</label>
                    <input type="range" class="weight-slider" id="weight_price" min="0" max="50" value="25">
                    <div class="weight-value" id="weight_price_value">25%</div>
                </div>
                <div class="weight-group">
                    <label class="form-label">Range (20%)</label>
                    <input type="range" class="weight-slider" id="weight_range" min="0" max="50" value="20">
                    <div class="weight-value" id="weight_range_value">20%</div>
                </div>
                <div class="weight-group">
                    <label class="form-label">Speed (20%)</label>
                    <input type="range" class="weight-slider" id="weight_speed" min="0" max="50" value="20">
                    <div class="weight-value" id="weight_speed_value">20%</div>
                </div>
                <div class="weight-group">
                    <label class="form-label">Passengers (15%)</label>
                    <input type="range" class="weight-slider" id="weight_passengers" min="0" max="50" value="15">
                    <div class="weight-value" id="weight_passengers_value">15%</div>
                </div>
                <div class="weight-group">
                    <label class="form-label">Fuel Efficiency (10%)</label>
                    <input type="range" class="weight-slider" id="weight_fuel_efficiency" min="0" max="50" value="10">
                    <div class="weight-value" id="weight_fuel_efficiency_value">10%</div>
                </div>
                <div class="weight-group">
                    <label class="form-label">Cabin Comfort (10%)</label>
                    <input type="range" class="weight-slider" id="weight_cabin_comfort" min="0" max="50" value="10">
                    <div class="weight-value" id="weight_cabin_comfort_value">10%</div>
                </div>
            </div>
        </div>

        <!-- Search Button -->
        <button type="submit" class="search-btn" id="searchBtn">
            <i class="fas fa-search"></i>
            Get AI Recommendations - $5
        </button>

        <!-- Loading Section -->
        <div class="loading-section" id="loadingSection">
            <div class="loading-spinner"></div>
            <div class="loading-text">Analyzing aircraft database and calculating match scores...</div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <h2 class="section-title">Recommended Aircraft</h2>
                <div class="results-count" id="resultsCount"></div>
            </div>
            <div id="recommendationsList"></div>
        </div>

        <!-- No Results -->
        <div class="no-results" id="noResults" style="display: none;">
            <h3>No Recommendations Found</h3>
            <p>Try adjusting your requirements or weight preferences to find suitable aircraft.</p>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('recommendationsForm');
        const searchBtn = document.getElementById('searchBtn');
        const loadingSection = document.getElementById('loadingSection');
        const resultsSection = document.getElementById('resultsSection');
        const noResults = document.getElementById('noResults');
        const resultsCount = document.getElementById('resultsCount');
        const recommendationsList = document.getElementById('recommendationsList');

        // Weight sliders
        const weightSliders = {
            price: document.getElementById('weight_price'),
            range: document.getElementById('weight_range'),
            speed: document.getElementById('weight_speed'),
            passengers: document.getElementById('weight_passengers'),
            fuel_efficiency: document.getElementById('weight_fuel_efficiency'),
            cabin_comfort: document.getElementById('weight_cabin_comfort')
        };

        // Update weight displays
        Object.keys(weightSliders).forEach(key => {
            const slider = weightSliders[key];
            const valueDisplay = document.getElementById(`weight_${key}_value`);

            slider.addEventListener('input', function () {
                valueDisplay.textContent = this.value + '%';
            });
        });

        // Form submission
        searchBtn.addEventListener('click', function (e) {
            e.preventDefault();
            submitRecommendationRequest();
        });

        function submitRecommendationRequest() {
            // Validate form
            const passengers = document.getElementById('passengers').value;
            const typical_range = document.getElementById('typical_range').value;
            const max_budget = document.getElementById('max_budget').value;

            if (!passengers || !typical_range || !max_budget) {
                alert('Please fill in all required fields.');
                return;
            }

            // Collect weights
            const weights = {};
            Object.keys(weightSliders).forEach(key => {
                weights[key] = parseInt(weightSliders[key].value);
            });

            // Prepare request data
            const requestData = {
                passengers: parseInt(passengers),
                typical_range: parseInt(typical_range),
                max_budget: parseFloat(max_budget),
                airport_preferences: document.getElementById('airport_preferences').value,
                weights: weights
            };

            // Show loading
            showLoading();

            // Submit request
            fetch('/api/aircraft-recommendations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
                .then(response => response.json())
                .then(data => {
                    hideLoading();

                    if (data.success) {
                        displayRecommendations(data.recommendations);
                    } else {
                        if (data.error.includes('credits') || data.error.includes('purchase')) {
                            // Handle payment required
                            handlePaymentRequired();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    }
                })
                .catch(error => {
                    hideLoading();
                    console.error('Error:', error);
                    alert('An error occurred while processing your request.');
                });
        }

        function showLoading() {
            loadingSection.style.display = 'block';
            resultsSection.style.display = 'none';
            noResults.style.display = 'none';
            searchBtn.disabled = true;
        }

        function hideLoading() {
            loadingSection.style.display = 'none';
            searchBtn.disabled = false;
        }

        function displayRecommendations(recommendations) {
            if (!recommendations || recommendations.length === 0) {
                noResults.style.display = 'block';
                return;
            }

            resultsCount.textContent = `Found ${recommendations.length} recommended aircraft`;
            resultsSection.style.display = 'block';

            recommendationsList.innerHTML = recommendations.map(aircraft => `
            <div class="aircraft-recommendation">
                <img src="/static/images/aircraft/${aircraft.image}" 
                     alt="${aircraft.manufacturer} ${aircraft.model}" 
                     class="aircraft-image"
                     onerror="this.src='/static/images/aircraft_placeholder.jpg'">
                
                <div class="aircraft-info">
                    <div class="aircraft-name">${aircraft.manufacturer} ${aircraft.model}</div>
                    <div class="aircraft-subtitle">${aircraft.aircraft_name}</div>
                    
                    <div class="specs-row">
                        <div class="spec-item">
                            <div class="spec-label">Passengers</div>
                            <div class="spec-value">${aircraft.key_specs.passengers}</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-label">Range</div>
                            <div class="spec-value">${aircraft.key_specs.range.toLocaleString()} nm</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-label">Speed</div>
                            <div class="spec-value">${aircraft.key_specs.speed.toLocaleString()} kts</div>
                        </div>
                        <div class="spec-item">
                            <div class="spec-label">Fuel Burn</div>
                            <div class="spec-value">${aircraft.key_specs.fuel_burn} gph</div>
                        </div>
                    </div>
                    
                    <div class="pros-cons">
                        <div class="pros">
                            <div class="pros-title">Pros</div>
                            <ul class="pros-list">
                                ${aircraft.pros.map(pro => `<li>${pro}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="cons">
                            <div class="cons-title">Cons</div>
                            <ul class="cons-list">
                                ${aircraft.cons.map(con => `<li>${con}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <a href="/aircraft/${aircraft.aircraft_id}" class="view-details-btn">
                        <i class="fas fa-info-circle"></i> View Details
                    </a>
                </div>
                
                <div class="score-section">
                    <div class="match-score ${getScoreClass(aircraft.match_score)}">${aircraft.match_score}%</div>
                    <div class="score-label">Match Score</div>
                    
                    <div class="price-estimate">$${aircraft.price_estimate.toLocaleString()}</div>
                    <div class="budget-status ${aircraft.budget_fit.includes('Within') ? 'budget-good' : 'budget-over'}">
                        ${aircraft.budget_fit}
                    </div>
                </div>
            </div>
        `).join('');
        }

        function getScoreClass(score) {
            if (score >= 80) return 'score-excellent';
            if (score >= 60) return 'score-good';
            return 'score-fair';
        }

        function handlePaymentRequired() {
            if (confirm('You need to purchase a search credit for $5. Proceed to checkout?')) {
                // Redirect to checkout or show payment modal
                window.location.href = '/pricing';
            }
        }
    });
</script>
{% endblock %}